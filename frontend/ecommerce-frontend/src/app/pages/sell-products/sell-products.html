!-- Pantalla completa -->
<div class="screen">
  <!-- Header -->
  <header class="header">
    <button class="icon-btn" type="button" (click)="goHome()" aria-label="Volver">
      üè†
    </button>
    <div class="header-title">PUBLICAR PRODUCTO</div>
    <span class="icon-spacer"></span>
  </header>

  <!-- Contenido -->
  <main class="main-content">

    <!-- Mensajes -->
    <div *ngIf="okMsg" class="alert ok">{{ okMsg }}</div>
    <div *ngIf="errorMsg" class="alert error">{{ errorMsg }}</div>

    <form [formGroup]="form" (ngSubmit)="onSubmit()" novalidate>
      
      <!-- üÜï Fotos / Subir Im√°genes -->
      <section class="form-section">
        <h3>Fotos</h3>
        <label for="imagenes">Im√°genes del Producto *</label>
        <input 
          type="file" 
          id="imagenes"
          accept="image/jpeg,image/png" 
          multiple
          (change)="onFileSelected($event)"
          class="file-input"
          [disabled]="enviando"
        >
        <p class="help-text">üì∏ M√°ximo 5 im√°genes ‚Ä¢ JPG o PNG ‚Ä¢ 5MB cada una</p>
        
        <!-- Previews -->
        <div class="previews" *ngIf="previewUrls().length > 0">
          <div class="preview-item" *ngFor="let url of previewUrls(); let i = index">
            <img [src]="url" [alt]="'Preview ' + (i + 1)">
            <button 
              type="button" 
              (click)="removePreview(i)" 
              class="btn-remove"
              [disabled]="enviando"
            >
              ‚úï
            </button>
            <span class="badge-principal" *ngIf="i === 0">Principal</span>
          </div>
        </div>
      </section>

      <!-- Mensaje de progreso -->
      <div class="progress-message" *ngIf="progresoUpload()">
        {{ progresoUpload() }}
      </div>

      <!-- Detalles -->
      <section class="form-section">
        <h3>Detalles</h3>

        <label for="titulo">T√≠tulo</label>
        <input id="titulo" type="text" formControlName="titulo" placeholder="Ej: Mouse gamer RGB">
        <div class="invalid" *ngIf="f['titulo']?.invalid && (f['titulo']?.dirty || f['titulo']?.touched)">
          <span *ngIf="f['titulo']?.errors?.['required']">El t√≠tulo es obligatorio.</span>
          <span *ngIf="f['titulo']?.errors?.['minlength']">M√≠nimo 3 caracteres.</span>
          <span *ngIf="f['titulo']?.errors?.['maxlength']">M√°ximo 120 caracteres.</span>
        </div>

        <label for="descripcion">Descripci√≥n</label>
        <textarea id="descripcion" formControlName="descripcion" placeholder="Ej: BT, poco uso..."></textarea>
        <div class="invalid" *ngIf="f['descripcion']?.invalid && (f['descripcion']?.dirty || f['descripcion']?.touched)">
          <span *ngIf="f['descripcion']?.errors?.['required']">La descripci√≥n es obligatoria.</span>
          <span *ngIf="f['descripcion']?.errors?.['minlength']">M√≠nimo 8 caracteres.</span>
          <span *ngIf="f['descripcion']?.errors?.['maxlength']">M√°ximo 2000 caracteres.</span>
        </div>

        <label for="categoria">Categor√≠a</label>
        <select id="categoria" formControlName="categoria">
          <option value="">Selecciona una categor√≠a</option>
          <option *ngFor="let c of categorias()" [value]="c">{{ c }}</option>
          <option [value]="OTRA">Otra‚Ä¶</option>
        </select>
        <div class="invalid" *ngIf="f['categoria']?.invalid && (f['categoria']?.dirty || f['categoria']?.touched)">
          La categor√≠a es obligatoria.
        </div>

        <div *ngIf="mostrarNuevaCategoria()" class="mt-8">
          <label for="nuevaCategoria">Nueva categor√≠a</label>
          <input id="nuevaCategoria" type="text" formControlName="nuevaCategoria" placeholder="Escribe la nueva categor√≠a" />
          <div class="invalid" *ngIf="f['nuevaCategoria']?.invalid && (f['nuevaCategoria']?.dirty || f['nuevaCategoria']?.touched)">
            <span *ngIf="f['nuevaCategoria']?.errors?.['required']">Este campo es obligatorio.</span>
            <span *ngIf="f['nuevaCategoria']?.errors?.['minlength']">M√≠nimo 3 caracteres.</span>
            <span *ngIf="f['nuevaCategoria']?.errors?.['maxlength']">M√°ximo 60 caracteres.</span>
          </div>
        </div>

        <label for="estado">Estado</label>
        <select id="estado" formControlName="estado">
          <option value="nuevo">Nuevo</option>
          <option value="usado">Usado</option>
        </select>
        <div class="invalid" *ngIf="f['estado']?.invalid && (f['estado']?.dirty || f['estado']?.touched)">
          El estado es obligatorio.
        </div>

        <label for="precio">Precio ($)</label>
        <input id="precio" type="number" step="0.01" min="0.01" formControlName="precio" placeholder="Ej: 20.00">
        <div class="invalid" *ngIf="f['precio']?.invalid && (f['precio']?.dirty || f['precio']?.touched)">
          <span *ngIf="f['precio']?.errors?.['required']">El precio es obligatorio.</span>
          <span *ngIf="f['precio']?.errors?.['min']">Debe ser mayor a 0.</span>
        </div>
      </section>

      <div style="height: 28px;"></div>

      <!-- Barra de acci√≥n -->
      <div class="action-bar">
        <button class="cta-button" type="submit" [disabled]="form.invalid || enviando || selectedFiles().length === 0">
          {{ enviando ? (subiendoImagenes ? 'Subiendo...' : 'Publicando‚Ä¶') : 'PUBLICAR AHORA' }}
        </button>
      </div>
    </form>
  </main>
</div>