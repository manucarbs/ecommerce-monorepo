<div class="screen">
  <!-- Header -->
  <header class="header">
    <button class="btn-back" (click)="volver()">‚Üê Volver</button>
    <h1 class="header-title">DETALLE</h1>
    
    <!-- Bot√≥n de Favorito en Header -->
    @if (!esElDueno) {
      <button 
        class="btn-favorito-header"
        (click)="toggleFavorito()"
        [disabled]="toggleandoFavorito()"
        [class.activo]="esFavorito()"
        [attr.aria-label]="esFavorito() ? 'Quitar de favoritos' : 'Agregar a favoritos'"
      >
        {{ esFavorito() ? '‚ù§Ô∏è' : 'ü§ç' }}
      </button>
    } @else {
      <span class="spacer-small"></span>
    }
  </header>

  <!-- Loading -->
  @if (cargando()) {
    <div class="loading-container">
      <div class="spinner"></div>
      <p>Cargando producto...</p>
    </div>
  }

  <!-- Error -->
  @if (errorMsg()) {
    <div class="error-container">
      <p>‚ùå {{ errorMsg() }}</p>
      <button class="btn-secondary" (click)="volver()">Volver al inicio</button>
    </div>
  }

  <!-- Contenido del Producto -->
  @if (!cargando() && producto()) {
    <main class="content">
      <div class="producto-container">
        
        <!-- Galer√≠a de Im√°genes -->
        <section class="galeria-section">
          <!-- Imagen Principal -->
          <div class="imagen-principal" (click)="abrirGaleria(imagenActual())">
            <img [src]="imagenes[imagenActual()]" [alt]="producto()!.titulo">
            <div class="zoom-hint">üîç Click para ampliar</div>
            <div class="badge-estado" [class.usado]="producto()!.estado === 'usado'">
              {{ producto()!.estado === 'nuevo' ? '‚ú® Nuevo' : 'üîÑ Usado' }}
            </div>
            
            <!-- Badge de Favorito en la imagen -->
            @if (!esElDueno && esFavorito()) {
              <div class="badge-favorito">
                ‚ù§Ô∏è En favoritos
              </div>
            }
          </div>

          <!-- Miniaturas -->
          @if (imagenes.length > 1) {
            <div class="miniaturas">
              @for (img of imagenes; track $index) {
                <button 
                  class="miniatura"
                  [class.active]="imagenActual() === $index"
                  (click)="seleccionarImagen($index)"
                >
                  <img [src]="img" [alt]="'Imagen ' + ($index + 1)">
                </button>
              }
            </div>
          }
        </section>

        <!-- Informaci√≥n del Producto -->
        <section class="info-section">
          <!-- Precio y T√≠tulo -->
          <div class="precio-container">
            <h1 class="titulo">{{ producto()!.titulo }}</h1>
            <p class="precio">{{ formatearPrecio(producto()!.precio) }}</p>
          </div>

          <!-- Categor√≠a y Stock -->
          <div class="meta-info">
            <span class="badge-categoria">üì¶ {{ producto()!.categoria }}</span>
            <span class="badge-stock" [class.agotado]="producto()!.stock === 0">
              {{ producto()!.stock > 0 ? '‚úÖ Disponible (' + producto()!.stock + ')' : '‚ùå Agotado' }}
            </span>
          </div>

          <!-- Descripci√≥n -->
          <div class="descripcion-container">
            <h3>Descripci√≥n</h3>
            <p>{{ producto()!.descripcion }}</p>
          </div>

          <!-- Informaci√≥n Adicional -->
          <div class="detalles">
            <h3>Detalles</h3>
            <div class="detalle-item">
              <span class="label">Publicado:</span>
              <span class="value">{{ formatearFecha(producto()!.creadoEn) }}</span>
            </div>
            <div class="detalle-item">
              <span class="label">√öltima actualizaci√≥n:</span>
              <span class="value">{{ formatearFecha(producto()!.actualizadoEn) }}</span>
            </div>
            <div class="detalle-item">
              <span class="label">ID del producto:</span>
              <span class="value">#{{ producto()!.id }}</span>
            </div>
          </div>

          <!-- Botones de Acci√≥n -->
          <div class="acciones">
            @if (esElDueno) {
              <!-- Si es el due√±o -->
              <button class="btn-editar" (click)="editarProducto()">
                ‚úèÔ∏è Editar Producto
              </button>
              <button 
                class="btn-eliminar" 
                (click)="eliminarProducto()"
                [disabled]="eliminando()"
              >
                {{ eliminando() ? '‚è≥ Eliminando...' : 'üóëÔ∏è Eliminar Producto' }}
              </button>
            } @else {
              <!-- Si NO es el due√±o -->
              
              <!-- Bot√≥n de Favoritos (alternativa grande) -->
              <button 
                class="btn-favorito"
                (click)="toggleFavorito()"
                [disabled]="toggleandoFavorito()"
                [class.activo]="esFavorito()"
              >
                {{ toggleandoFavorito() ? '‚è≥ Actualizando...' : esFavorito() ? '‚ù§Ô∏è En Favoritos' : 'ü§ç Agregar a Favoritos' }}
              </button>
              
              <button class="btn-contactar" (click)="contactarVendedor()">
                üí¨ Contactar Vendedor
              </button>
            }
          </div>
        </section>
      </div>
    </main>
  }

  <!-- Modal de Galer√≠a Fullscreen -->
  @if (mostrarGaleria()) {
    <div class="galeria-modal" (click)="cerrarGaleria()">
      <button class="btn-cerrar" (click)="cerrarGaleria()">‚úï</button>
      
      <button class="btn-nav btn-prev" (click)="imagenAnterior($event)">
        ‚Äπ
      </button>
      
      <div class="imagen-fullscreen" (click)="$event.stopPropagation()">
        <img [src]="imagenes[imagenActual()]" [alt]="producto()!.titulo">
      </div>
      
      <button class="btn-nav btn-next" (click)="imagenSiguiente($event)">
        ‚Ä∫
      </button>

      <div class="contador-imagenes">
        {{ imagenActual() + 1 }} / {{ imagenes.length }}
      </div>
    </div>
  }
</div>