<div class="app-screen">
  <!-- Header -->
  <header class="top-header">
    <button class="btn-back" (click)="volver()">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M19 12H5M12 19l-7-7 7-7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
      Volver
    </button>
    
    <h1 class="logo-text">
      <svg class="logo-icon" width="28" height="28" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M20.84 4.61C20.3292 4.099 19.7228 3.69364 19.0554 3.41708C18.3879 3.14052 17.6725 2.99817 16.95 2.99817C16.2275 2.99817 15.5121 3.14052 14.8446 3.41708C14.1772 3.69364 13.5708 4.099 13.06 4.61L12 5.67L10.94 4.61C9.9083 3.5783 8.50903 2.9987 7.05 2.9987C5.59096 2.9987 4.19169 3.5783 3.16 4.61C2.1283 5.64169 1.54871 7.04097 1.54871 8.5C1.54871 9.95903 2.1283 11.3583 3.16 12.39L12 21.23L20.84 12.39C21.351 11.8792 21.7563 11.2728 22.0329 10.6053C22.3095 9.93789 22.4518 9.22248 22.4518 8.5C22.4518 7.77752 22.3095 7.06211 22.0329 6.39467C21.7563 5.72723 21.351 5.12081 20.84 4.61V4.61Z" 
              stroke="url(#gradient)" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
        <defs>
          <linearGradient id="gradient" x1="0%" y1="0%" x2="100%" y2="100%">
            <stop offset="0%" stop-color="#3B82F6" />
            <stop offset="100%" stop-color="#8B5CF6" />
          </linearGradient>
        </defs>
      </svg>
      FAVORITOS
    </h1>
    
    <div class="header-count">
      <span class="badge-count">{{ cantidadFavoritos }}</span>
    </div>
  </header>

  <!-- Contenido principal desplazable -->
  <main class="main-content">
    <!-- Loading -->
    @if (cargando()) {
      <div class="state" role="status" aria-live="polite">
        <div class="loading-spinner"></div>
        <span>Cargando favoritos...</span>
      </div>
    }

    <!-- Error -->
    @if (errorMsg()) {
      <div class="state error" role="alert">
        <div class="error-icon">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M12 9V11M12 15H12.01M5.07183 19H18.9282C20.4678 19 21.4301 17.3333 20.6603 16L13.7321 4C12.9623 2.66667 11.0377 2.66667 10.2679 4L3.33975 16C2.56995 17.3333 3.53223 19 5.07183 19Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </div>
        {{ errorMsg() }}
        <button class="btn-retry" (click)="cargarFavoritos()">
          Reintentar
        </button>
      </div>
    }

    <!-- Lista Vac√≠a -->
    @if (!cargando() && !errorMsg() && favoritos().length === 0) {
      <div class="state">
        <div class="empty-icon">
          <svg width="48" height="48" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M20.84 4.61C20.3292 4.099 19.7228 3.69364 19.0554 3.41708C18.3879 3.14052 17.6725 2.99817 16.95 2.99817C16.2275 2.99817 15.5121 3.14052 14.8446 3.41708C14.1772 3.69364 13.5708 4.099 13.06 4.61L12 5.67L10.94 4.61C9.9083 3.5783 8.50903 2.9987 7.05 2.9987C5.59096 2.9987 4.19169 3.5783 3.16 4.61C2.1283 5.64169 1.54871 7.04097 1.54871 8.5C1.54871 9.95903 2.1283 11.3583 3.16 12.39L12 21.23L20.84 12.39C21.351 11.8792 21.7563 11.2728 22.0329 10.6053C22.3095 9.93789 22.4518 9.22248 22.4518 8.5C22.4518 7.77752 22.3095 7.06211 22.0329 6.39467C21.7563 5.72723 21.351 5.12081 20.84 4.61V4.61Z" 
                  stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </div>
        <h3>No tienes favoritos a√∫n</h3>
        <p>Explora productos y agr√©galos a tu lista de favoritos</p>
        <button class="btn-primary" (click)="volver()">
          Ir al inicio
        </button>
      </div>
    }

    <!-- Grid de Favoritos -->
    @if (!cargando() && !errorMsg() && favoritos().length > 0) {
      <section class="products-section">
        <h2 class="section-title">Tus Productos Favoritos</h2>
        
        <div class="product-grid">
          @for (favorito of favoritos(); track favorito.id) {
            <article class="product-card">
              <!-- Imagen del Producto -->
              <div 
                class="product-image-container" 
                (click)="verProducto(favorito.productoId)"
              >
                <img 
                  class="product-image"
                  [src]="favorito.producto.imagenPrincipal || favorito.producto.imagenesUrl?.[0] || 'https://via.placeholder.com/400x300?text=' + favorito.producto.titulo" 
                  [alt]="favorito.producto.titulo"
                >
                
                <!-- Badge de Estado -->
                <div 
                  class="product-badge estado" 
                  [class.usado]="favorito.producto.estado === 'usado'"
                >
                  {{ favorito.producto.estado === 'nuevo' ? '‚ú® Nuevo' : 'üîÑ Usado' }}
                </div>

                <!-- Badge de Stock -->
                @if (favorito.producto.stock === 0) {
                  <div class="product-badge agotado">‚ùå Agotado</div>
                }

                <!-- Badge Favorito -->
                <div class="product-badge favorito">‚ù§Ô∏è</div>
              </div>

              <!-- Informaci√≥n del Producto -->
              <div class="product-content" (click)="verProducto(favorito.productoId)">
                <h3 class="product-title">{{ favorito.producto.titulo }}</h3>
                
                <p class="product-description">
                  üì¶ {{ favorito.producto.categoria }}
                </p>

                <p class="product-price">
                  {{ formatearPrecio(favorito.producto.precio) }}
                </p>

                <p class="product-category">
                  ‚ù§Ô∏è Agregado el {{ formatearFecha(favorito.agregadoEn) }}
                </p>
              </div>

              <!-- Bot√≥n de Eliminar -->
              <div class="product-actions">
                <button 
                  class="btn-eliminar"
                  (click)="eliminarFavorito(favorito, $event)"
                  [disabled]="eliminandoId() === favorito.productoId"
                >
                  {{ 
                    eliminandoId() === favorito.productoId 
                      ? '‚è≥ Eliminando...' 
                      : 'üóëÔ∏è Eliminar' 
                  }}
                </button>
              </div>
            </article>
          }
        </div>
      </section>
    }

    <!-- Espaciador para scroll -->
    <div class="spacer"></div>
  </main>
</div>