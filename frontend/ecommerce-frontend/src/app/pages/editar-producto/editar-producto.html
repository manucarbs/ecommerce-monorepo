<div class="product-edit-screen">
  <!-- Header Mejorado -->
  <header class="edit-header">
    <div class="header-content">
      <button class="btn-back" type="button" (click)="cancelar()">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M19 12H5M12 19L5 12L12 5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        Volver
      </button>
      
      <h1 class="edit-title">EDITAR PRODUCTO</h1>
      
      <div class="header-spacer"></div>
    </div>
  </header>

  <!-- Estados de carga -->
  <div class="loading-state" *ngIf="cargando()">
    <div class="loading-spinner-large"></div>
    <p>Cargando producto...</p>
  </div>

  <!-- Contenido Principal -->
  <main class="edit-content" *ngIf="!cargando()">
    <!-- Mensajes -->
    <div class="state-messages">
      <div *ngIf="errorMsg()" class="alert" [class.success]="errorMsg().includes('‚úÖ')" [class.error]="!errorMsg().includes('‚úÖ')">
        <div class="alert-icon">{{ errorMsg().includes('‚úÖ') ? '‚úÖ' : '‚ö†Ô∏è' }}</div>
        <div class="alert-content">{{ errorMsg() }}</div>
      </div>
    </div>

    <form (ngSubmit)="guardarCambios()" *ngIf="producto() as p" novalidate class="edit-form">
      
      <!-- Secci√≥n de Detalles -->
      <section class="form-section details-section">
        <h2 class="section-title">
          <span class="section-icon">üìã</span>
          Detalles del Producto
        </h2>

        <div class="form-grid">
          <!-- T√≠tulo -->
          <div class="form-group">
            <label for="titulo" class="form-label">T√≠tulo del Producto *</label>
            <input 
              id="titulo" 
              type="text" 
              [(ngModel)]="p.titulo" 
              name="titulo" 
              placeholder="Ej: iPhone 13 Pro Max 256GB"
              required
              minlength="3"
              maxlength="120"
              class="form-input"
            >
          </div>

          <!-- Descripci√≥n -->
          <div class="form-group">
            <label for="descripcion" class="form-label">Descripci√≥n *</label>
            <textarea 
              id="descripcion" 
              [(ngModel)]="p.descripcion" 
              name="descripcion" 
              placeholder="Describe tu producto en detalle..."
              rows="4"
              required
              minlength="8"
              maxlength="2000"
              class="form-textarea"
            ></textarea>
          </div>

          <!-- Precio y Stock -->
          <div class="form-row">
            <div class="form-group">
              <label for="precio" class="form-label">Precio (USD) *</label>
              <div class="price-input-container">
                <span class="currency-symbol">$</span>
                <input 
                  id="precio" 
                  type="number" 
                  step="0.01" 
                  min="0.01" 
                  [(ngModel)]="p.precio" 
                  name="precio" 
                  placeholder="0.00"
                  required
                  class="form-input price-input"
                >
              </div>
            </div>

            <div class="form-group">
              <label for="stock" class="form-label">Stock Disponible *</label>
              <input 
                id="stock" 
                type="number" 
                min="0" 
                [(ngModel)]="p.stock" 
                name="stock" 
                placeholder="Ej: 10"
                required
                class="form-input"
              >
              <div class="help-text">
                üí° <strong>Stock:</strong> N√∫mero de unidades disponibles
              </div>
            </div>
          </div>

          <!-- WhatsApp -->
          <div class="form-group">
            <label for="whatsappContacto" class="form-label">WhatsApp (Opcional)</label>
            <input 
              id="whatsappContacto" 
              type="tel" 
              [(ngModel)]="p.whatsappContacto" 
              name="whatsappContacto" 
              placeholder="+50312345678"
              maxlength="20"
              pattern="^\+?\d{8,15}$"
              class="form-input"
            >
            <div class="help-text">
              üì± Incluye c√≥digo de pa√≠s para contacto directo
            </div>
          </div>
        </div>
      </section>

      <!-- Secci√≥n de Im√°genes Actuales -->
      <div class="images-container">
      <section class="form-section current-images-section">
        <h2 class="section-title">
          <span class="section-icon">üñºÔ∏è</span>
          Im√°genes Actuales
        </h2>
        
        <div class="help-text">
          Puedes eliminar im√°genes existentes haciendo clic en 
          <span class="delete-icon">‚úï</span>
        </div>
        
        <div class="previews-grid" *ngIf="p.imagenesUrl && p.imagenesUrl.length > 0">
          <div class="preview-card" *ngFor="let img of p.imagenesUrl; let i = index">
            <div class="preview-image-container">
              <img [src]="img" [alt]="'Imagen ' + (i + 1)" class="preview-image">
              <button 
                type="button" 
                (click)="eliminarImagenActual(i)" 
                class="btn-remove-preview"
                title="Eliminar imagen"
                [disabled]="guardando()"
              >
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </button>
              <div class="preview-badge" *ngIf="i === 0">Principal</div>
            </div>
          </div>
        </div>
        
        <div *ngIf="!p.imagenesUrl || p.imagenesUrl.length === 0" class="empty-state">
          <div class="empty-icon">üñºÔ∏è</div>
          <p>No hay im√°genes actuales para este producto</p>
        </div>
      </section>

      <!-- Secci√≥n de Nuevas Im√°genes -->
      <section class="form-section new-images-section">
        <h2 class="section-title">
          <span class="section-icon">‚ûï</span>
          Agregar Nuevas Im√°genes
        </h2>

        <div class="upload-area">
          <input 
            type="file" 
            id="nuevas"
            accept="image/jpeg,image/png" 
            multiple
            (change)="onFileSelected($event)"
            class="file-input"
            [disabled]="guardando()"
          >
          <label for="nuevas" class="upload-label">
            <div class="upload-icon">üìÅ</div>
            <div class="upload-text">
              <strong>Seleccionar nuevas im√°genes</strong>
              <span>M√°ximo 5 im√°genes ‚Ä¢ JPG o PNG ‚Ä¢ 5MB cada una</span>
            </div>
          </label>
        </div>

        <!-- Previsualizaciones de nuevas im√°genes -->
        <div class="previews-grid" *ngIf="previewUrls().length > 0">
          <div class="preview-card" *ngFor="let url of previewUrls(); let i = index">
            <div class="preview-image-container">
              <img [src]="url" [alt]="'Nueva imagen ' + (i + 1)" class="preview-image">
              <button 
                type="button" 
                (click)="removePreview(i)" 
                class="btn-remove-preview"
                title="Quitar imagen"
                [disabled]="guardando()"
              >
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </button>
            </div>
          </div>
        </div>
      </section>

      <!-- Progreso de subida -->
      <div class="upload-progress" *ngIf="progresoUpload()">
        <div class="progress-indicator">
          <div class="progress-bar">
            <div class="progress-fill"></div>
          </div>
          <span class="progress-text">{{ progresoUpload() }}</span>
        </div>
      </div>
    </div>

      <!-- Espaciador para el bot√≥n fijo -->
      <div class="form-spacer"></div>
    </form>
  </main>

  <!-- Barra de Acci√≥n Fija -->
  <footer class="action-footer">
    <div class="action-content">
      <button 
        class="save-button" 
        type="submit" 
        [disabled]="guardando()"
        (click)="guardarCambios()"
      >
        <div class="button-content">
          <span class="button-icon" *ngIf="!guardando()">üíæ</span>
          <div class="button-loading" *ngIf="guardando()">
            <div class="loading-spinner"></div>
          </div>
          <span class="button-text">
            {{ guardando() ? (subiendoImagenes ? 'SUBIR IM√ÅGENES...' : 'GUARDANDO...') : 'GUARDAR CAMBIOS' }}
          </span>
        </div>
        <div class="button-subtext" *ngIf="!guardando()">
          Actualizar informaci√≥n del producto
        </div>
      </button>
    </div>
  </footer>
</div>