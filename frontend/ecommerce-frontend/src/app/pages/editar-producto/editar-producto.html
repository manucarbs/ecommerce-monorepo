<div class="screen">
  <!-- Header -->
  <header class="header">
    <button class="icon-btn" type="button" (click)="cancelar()" aria-label="Volver">
      ‚Üê
    </button>
    <div class="header-title">EDITAR PRODUCTO</div>
    <span class="icon-spacer"></span>
  </header>

  <!-- Contenido -->
  <main class="main-content" *ngIf="!cargando(); else cargandoTpl">

    <!-- Mensajes -->
    <div *ngIf="errorMsg()" class="alert error">{{ errorMsg() }}</div>

    <form (ngSubmit)="guardarCambios()" *ngIf="producto() as p" novalidate>
      
      <!-- Detalles -->
      <section class="form-section">
        <h3>Detalles</h3>

        <label for="titulo">T√≠tulo</label>
        <input 
          id="titulo" 
          type="text" 
          [(ngModel)]="p.titulo" 
          name="titulo" 
          placeholder="Ej: Mouse gamer RGB"
          required
        >

        <label for="descripcion">Descripci√≥n</label>
        <textarea 
          id="descripcion" 
          [(ngModel)]="p.descripcion" 
          name="descripcion" 
          placeholder="Ej: BT, poco uso..."
          rows="4"
        ></textarea>

        <label for="precio">Precio ($)</label>
        <input 
          id="precio" 
          type="number" 
          step="0.01" 
          min="0" 
          [(ngModel)]="p.precio" 
          name="precio" 
          placeholder="Ej: 20.00"
          required
        >
      </section>

      <!-- Im√°genes actuales -->
      <section class="form-section">
        <h3>üñºÔ∏è Im√°genes actuales</h3>
        
        <div class="previews" *ngIf="p.imagenesUrl && p.imagenesUrl.length > 0">
          <div class="preview-item" *ngFor="let img of p.imagenesUrl; let i = index">
            <img [src]="img" [alt]="'Imagen ' + (i + 1)">
            <button 
              type="button" 
              (click)="eliminarImagenActual(i)" 
              class="btn-remove"
              title="Eliminar"
            >
              ‚úï
            </button>
          </div>
        </div>
      </section>

      <!-- Agregar nuevas im√°genes -->
      <section class="form-section">
        <h3>Agregar nuevas im√°genes</h3>
        <label for="nuevas">Nuevas im√°genes (m√°x. 5)</label>
        <input 
          type="file" 
          id="nuevas"
          accept="image/*" 
          multiple
          (change)="onFileSelected($event)"
          class="file-input"
        >
        
        <!-- Previews de nuevas im√°genes -->
        <div class="previews" *ngIf="previewUrls().length > 0">
          <div class="preview-item" *ngFor="let url of previewUrls(); let i = index">
            <img [src]="url" [alt]="'Nueva imagen ' + (i + 1)">
            <button 
              type="button" 
              (click)="removePreview(i)" 
              class="btn-remove"
              title="Quitar"
            >
              ‚úï
            </button>
          </div>
        </div>
      </section>

      <!-- Mensaje de progreso -->
      <div class="progress-message" *ngIf="progresoUpload()">
        {{ progresoUpload() }}
      </div>

      <div style="height: 28px;"></div>

      <!-- Barra de acci√≥n -->
      <div class="action-bar">
        <button 
          class="cta-button" 
          type="submit" 
          [disabled]="guardando()"
        >
          {{ guardando() ? 'GUARDANDO‚Ä¶' : 'GUARDAR CAMBIOS' }}
        </button>
      </div>
    </form>
  </main>
</div>

<ng-template #cargandoTpl>
  <div class="screen">
    <header class="header">
      <span class="icon-spacer"></span>
      <div class="header-title">EDITAR PRODUCTO</div>
      <span class="icon-spacer"></span>
    </header>
    <main class="main-content">
      <div class="progress-message">Cargando producto...</div>
    </main>
  </div>
</ng-template>